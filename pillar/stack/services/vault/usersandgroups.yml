---
{% set user = stack['vault']['user']['name'] %}
{% set home = stack['vault']['user']['home']  %}

usersandgroups:
  users:
    {{ user }}:
      home: {{ home }}
      shell: /bin/bash
      groups:
        - users
        - vault
        - root
      ssh_pubkey:
        manage: False
        sources:
{% for user, values in stack['digitastuces']['team_infra'].items() %}
          - salt://ssh_keys/{{ user }}.pub
{% endfor %}
    # Add TeamDev users in vault group
    {% for user, values in stack['digitastuces']['team_dev'].items() %}
    {% do values['groups'].append('vault') %}
    {{ user }}:
      {{ values }}
    {% endfor %}
